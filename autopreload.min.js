/*
 * autopreload.js v0.1
 *
 *
 * Purpose of this utility is to automatically preload images 
 * from css stylesheets in order to avoid unpleasant flicker effect.
 *
 * Krystian Jarmicki, 2013; Licensed MIT
 * @preserve
 */
(function(e){"use strict";e.autopreload=function(e){var t={_states:[":hover",":active",":focus",":checked"],_sources:[],_images:[],_loaded:0,_userSelectors:{modify:function(e,t){var s;if("[object Array]"===Object.prototype.toString.call(t))for(s=0;t.length>s;s++)this.modify(e,t[s]);else-1===this[e].indexOf("selector")&&this[e].push(t)},add:[],ignore:[]},_onload:null,_getFileDir:function(e){var t=e.split("").reverse().join("");return t.indexOf("/")>-1?t.substr(t.indexOf("/")).split("").reverse().join(""):e},_fullPathSource:function(e,t){return e=e.replace(/\"/g,""),e=-1===e.indexOf(t)?e.replace("url(",t).replace(")",""):e.replace("url(","").replace(")","")},_walkSubtree:function(e,t){var s;if(e.cssRules||e.rules)this._walkSubtree(e.cssRules||e.rules,t);else if(e.length)for(s=0;e.length>s;s++)this._walkSubtree(e[s],t);else e.selectorText&&this._extractUrls(e,t)},_extractUrls:function(e,t){var s,r=!1;for(s=0;this._states.length>s;s++)e.selectorText.indexOf(this._states[s])>-1&&(r=!0);if(r||this._userSelectors.add.indexOf(e.selectorText)>-1&&(r=!0),r&&-1===this._userSelectors.ignore.indexOf(e.selectorText))for(s in e.style)e.style[s]&&"string"==typeof e.style[s]&&0===e.style[s].indexOf("url(")&&e.style[s].indexOf(")")===e.style[s].length-1&&-1===this._sources.indexOf(this._fullPathSource(e.style[s],t))&&this._sources.push(this._fullPathSource(e.style[s],t))},getSources:function(){var t;for(this._sources.length=0,t=0;e.document.styleSheets.length>t;t++)this._walkSubtree(e.document.styleSheets[t],this._getFileDir(e.document.styleSheets[t].href));return this._sources},_createImages:function(){var t,s=this;for(this._images=[],this._loaded=0,t=0;this._sources.length>t;t++)this._images[t]=e.document.createElement("img"),this._images[t].onload=function(){++s._loaded===s._sources.length&&"function"==typeof s._onload&&s._onload.call(s,s._images)},this._images[t].src=this._sources[t];return this._images},add:function(e){return this._userSelectors.modify("add",e),this},ignore:function(e){return this._userSelectors.modify("ignore",e),this},run:function(){return this.getSources(),this._createImages()},onload:function(e){return"function"==typeof e&&(this._onload=e),this},reset:function(){return this._userSelectors.add.length=this._userSelectors.ignore.length=this._sources.length=this._loaded=0,this._images=[],this._onload=null,this}};Array.prototype.indexOf||(t._userSelectors.add.indexOf=t._userSelectors.ignore.indexOf=t._sources.indexOf=function(e){var t;for(t=0;this.length>t;t++)if(this[t]===e)return e;return-1});var s=function(){var e=Array.prototype.slice.call(arguments),t=e.shift(),s=e.shift();return function(){return t.apply(s,arguments)}};return{run:s(t.run,t),getSources:s(t.getSources,t),add:s(t.add,t),ignore:s(t.ignore,t),onload:s(t.onload,t),reset:s(t.reset,t)}}(e)})(this);